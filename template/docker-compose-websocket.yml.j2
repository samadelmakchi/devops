services:
  {{ customer_containers }}-websocket:
    container_name: {{ customer_containers }}-websocket
    build:
      context: {{ project_path }}/{{ inventory_hostname }}/websocket
      dockerfile: Dockerfile
    ports:
      - {{ customer_websocket_ports }}:3000
    networks:
      - traefik_reverse_proxy
    environment:
      - NODE_ENV=production
      - INSTANCE_NAME: {{ customer_containers }}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.{{ customer_containers }}-websocket.rule=Host(`{{ customer_subdomain_websocket }}.{{ customer_domain }}`)"
      - "traefik.http.routers.{{ customer_containers }}-websocket.entrypoints=websecure"
      - "traefik.http.routers.{{ customer_containers }}-websocket.tls.certresolver=myresolver"
      - "traefik.http.services.{{ customer_containers }}-websocket.loadbalancer.server.port=3000"

networks:
  traefik_reverse_proxy:
    external: true
