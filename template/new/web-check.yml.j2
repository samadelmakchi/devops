services:
  web-check:
    container_name: web-check
    image: lissy93/web-check:latest
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - TZ=Etc/UTC
      - WEBCHECK_API_KEY=wc-secret-123
    networks:
      - traefik_reverse_proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.web-check.rule=Host(`webcheck.{{ domain }}`)"
      - "traefik.http.routers.web-check.entrypoints=websecure"
      - "traefik.http.routers.web-check.tls=true"
      - "traefik.http.routers.web-check.tls.certresolver=myresolver"
      - "traefik.http.services.web-check.loadbalancer.server.port=3000"
      - "traefik.http.routers.web-check-http.rule=Host(`webcheck.{{ domain }}`)"
      - "traefik.http.routers.web-check-http.entrypoints=web"
      - "traefik.http.routers.web-check-http.middlewares=web-check-https-redirect"
      - "traefik.http.middlewares.web-check-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.web-check-https-redirect.redirectscheme.permanent=true"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 60s
      timeout: 10s
      retries: 5
      start_period: 30s

networks:
  traefik_reverse_proxy:
    name: traefik_reverse_proxy
    driver: bridge
    external: true