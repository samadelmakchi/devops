services:
  ddns-go:
    container_name: ddns-go
    image: jeessy/ddns-go:latest
    restart: unless-stopped
    ports:
      - "9876:9876"
    volumes:
      - ./ddns-go:/root
    environment:
      - TZ=Etc/UTC
      - DDNS_LISTEN=:9876
      - DDNS_FREQUENCY=600
    networks:
      - traefik_reverse_proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.ddns-go.rule=Host(`ddns.{{ domain }}`)"
      - "traefik.http.routers.ddns-go.entrypoints=websecure"
      - "traefik.http.routers.ddns-go.tls=true"
      - "traefik.http.routers.ddns-go.tls.certresolver=myresolver"
      - "traefik.http.services.ddns-go.loadbalancer.server.port=9876"
      - "traefik.http.routers.ddns-go-http.rule=Host(`ddns.{{ domain }}`)"
      - "traefik.http.routers.ddns-go-http.entrypoints=web"
      - "traefik.http.routers.ddns-go-http.middlewares=ddns-go-https-redirect"
      - "traefik.http.middlewares.ddns-go-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.ddns-go-https-redirect.redirectscheme.permanent=true"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9876"]
      interval: 60s
      timeout: 10s
      retries: 5
      start_period: 30s

networks:
  traefik_reverse_proxy:
    name: traefik_reverse_proxy
    driver: bridge
    external: true